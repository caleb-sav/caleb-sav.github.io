Mechanical Design
===============================================================

Unlike previous class projects, most hardware hardware was not provided, or even specified. 
This gave us the opportunity to design the entire system from the ground up. The Nucleo L476, 
motor drivers, and motors were made available to us by our instructor, guiding some design 
decisions, but the rest was up to us.

Inspired by similarly designed 3D printers, we quickly decided on a triangulating design, where 
two 'arms' are allowed to pivot freely, locating the pen by their different lengths.

.. image:: ../Images/prelimSketch1.jpg
   :width: 3 in
   :align: center
   
We considered a number of different ways to control the length of the arms. We thought of power 
screws, but balked at the complexity of driving the shaft, while still maintaining a stable 
connection to the static pen.

.. image:: ../Images/prelimSketch2.jpg
   :width: 3 in
   :align: center
   
A rack and pinion seemed like a good option since the rack doesn't rotate, but it posed a 
significant manufacturing challenge and could incur too much slop. We considered a smooth 
rod with rubber rollers, but were concerned with slipping. 

Finally, we found a way to blend the best of these ideas into one using a power screw, but 
instead of rotating the shaft, we planned to rotate the nut.

**[Image here of the final sketch]**




Analysis
---------
The bulk of the math involved for this project was in the kinematics. Getting from arm lengths 
to X Y coordinates was straightforward, but going back the other way is not. Fortunately, 
the Newton-Raphson algorithm can help with this, iteratively applying input values to the 
forward kinematics until X Y outputs reach the target. More information on this algorithm 
can be found in the **[insert link for taskData]** task, but the building blocks (forward 
kinematics and the jacobian) are derived below.

.. image:: ../Images/handCalcs1.jpg
.. image:: ../Images/handCalcs2.jpg
.. image:: ../Images/handCalcs3.jpg
.. image:: ../Images/handCalcs4.jpg

To ensure that the Newton-Raphson approach would work, we simulated the system using Jupyter. **[Probably link to the notebook]**
The Newton-Raphson algorithm was applied to the points in a circle, then the forward kinematics 
were solved to get the resulting X Y points. As shown in the animation below, the results 
were nearly perfect.

.. image:: ../Images/simulation.gif
   :width: 5 in
   :align: center

CAD
--------
The majority of the components were first modeled in SolidWorks to ensure correct fitment. 
This made the 3D printed parts easy to design, since their dimensions could be defined by 
referencing other parts.

.. image:: ../Images/CAD1.jpg

The gear was designed using the SolidWorks toolbox to fit neatly over the power screw nut 
and mesh with the original gear on the stepper motor.

.. image:: ../Images/CAD2.jpg


Manufacturing
-------------

BOM
^^^^^
* Nucleo L476 Microcontroller
* PM25S-048 Stepper Motors (2)
* Motor Driver circuitry
   * TMC2208 Stepper Drivers (2)
   * TMC4210 Step/Direction Controllers (2)
   * Miscellaneous electronics parts
* `Limit Switch (2) <https://www.amazon.com/MXRS-Hinge-Momentary-Button-Switch/dp/B07MW2RPJY/ref=lp_5739467011_1_1?th=1>`_
* `Power screw kit <https://www.youtube.com/watch?v=dQw4w9WgXcQ>`_
* `3D Printed Parts <https://www.youtube.com/watch?v=dQw4w9WgXcQ>`_
   * Support Connector (2)
   * Large Gear (2)
   * Lower Pen Connector
   * Upper Pen Connector
   * End Cap (2)
* 6-32 3/8 machine screws, Socket head (8)
* 8-32 1/4 machine screws (4)
* 8-32 nuts (4)
* 1/2 in Pan-head wood screws (4)
* 3/8 in Plywood

Our instructor provided the microcontroller used for the project: the Nucleo L476 equiped 
with a 'Shoe of Brian' for accessing the native USB. 

Motor Driver Board
^^^^^^^^^^^^^^^^^^
A motor driver PCB was also provided with an two integrated TMC4210 Step/Direction 
controllers and pin headers for standard stepper motor drivers (TMC2208 in this case).

.. image:: ../Images/driverSchem.png
.. image:: ../Images/driverBuilt.jpg

Motor Modification
^^^^^^^^^^^^^^^^^^
While some teams chose to purchase their own stepper motors, we decided to use the ones 
made available by our instructor. They appear to be 5- and 6-wire variants of the NMB 
PM25S-048, likely surplus or refurbished condition.